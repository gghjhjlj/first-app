import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium

st.set_page_config(page_title="수도권 신도시 지도", layout="wide")
st.title("🏙️ 수도권 신도시 기수별 정보 및 위치 시각화")

# 신도시 데이터 (1기, 2기, 3기)
new_towns = [
    # 1기
    {"신도시명": "분당신도시", "기수": "1기", "위도": 37.3786, "경도": 127.1146, "개발 규모": "19.6㎢", "주택 공급 호수": "96,000호", "교통망": "분당선, 경강선", "개발 연도": "1989년~1996년"},
    {"신도시명": "일산신도시", "기수": "1기", "위도": 37.6584, "경도": 126.7731, "개발 규모": "20.3㎢", "주택 공급 호수": "104,000호", "교통망": "일산선, 경의중앙선", "개발 연도": "1989년~1996년"},
    {"신도시명": "중동신도시", "기수": "1기", "위도": 37.5023, "경도": 126.7752, "개발 규모": "5.4㎢", "주택 공급 호수": "36,000호", "교통망": "7호선", "개발 연도": "1989년~1995년"},
    {"신도시명": "산본신도시", "기수": "1기", "위도": 37.3614, "경도": 126.9356, "개발 규모": "5.8㎢", "주택 공급 호수": "45,000호", "교통망": "4호선", "개발 연도": "1989년~1995년"},
    {"신도시명": "평촌신도시", "기수": "1기", "위도": 37.3974, "경도": 126.9530, "개발 규모": "5.2㎢", "주택 공급 호수": "43,000호", "교통망": "4호선", "개발 연도": "1989년~1995년"},

    # 2기
    {"신도시명": "판교신도시", "기수": "2기", "위도": 37.4021, "경도": 127.1086, "개발 규모": "8.9㎢", "주택 공급 호수": "29,000호", "교통망": "신분당선, 경강선", "개발 연도": "2003년~2010년"},
    {"신도시명": "위례신도시", "기수": "2기", "위도": 37.4781, "경도": 127.1435, "개발 규모": "6.8㎢", "주택 공급 호수": "42,000호", "교통망": "8호선, 위례신사선", "개발 연도": "2008년~2020년대"},
    {"신도시명": "동탄2신도시", "기수": "2기", "위도": 37.2092, "경도": 127.1084, "개발 규모": "24.3㎢", "주택 공급 호수": "119,000호", "교통망": "SRT, GTX-A", "개발 연도": "2008년~2027년"},
    {"신도시명": "김포한강신도시", "기수": "2기", "위도": 37.6400, "경도": 126.7000, "개발 규모": "11.8㎢", "주택 공급 호수": "50,000호", "교통망": "김포골드라인", "개발 연도": "2006년~2015년"},
    {"신도시명": "검단신도시", "기수": "2기", "위도": 37.5924, "경도": 126.6248, "개발 규모": "11.2㎢", "주택 공급 호수": "75,000호", "교통망": "인천1호선 연장, GTX-D", "개발 연도": "2007년~2030년"},

    # 3기
    {"신도시명": "남양주 왕숙", "기수": "3기", "위도": 37.6525, "경도": 127.2169, "개발 규모": "8.8㎢", "주택 공급 호수": "66,000호", "교통망": "GTX-B(예정), 경춘선", "개발 연도": "2020년대"},
    {"신도시명": "하남 교산", "기수": "3기", "위도": 37.5417, "경도": 127.1900, "개발 규모": "6.5㎢", "주택 공급 호수": "30,000호", "교통망": "지하철 3호선 연장", "개발 연도": "2020년대"},
    {"신도시명": "인천 계양", "기수": "3기", "위도": 37.5604, "경도": 126.7440, "개발 규모": "3.3㎢", "주택 공급 호수": "17,000호", "교통망": "GTX-B(예정), 공항철도", "개발 연도": "2020년대"},
    {"신도시명": "부천 대장", "기수": "3기", "위도": 37.5355, "경도": 126.8080, "개발 규모": "3.4㎢", "주택 공급 호수": "20,000호", "교통망": "서부광역철도", "개발 연도": "2020년대"},
    {"신도시명": "고양 창릉", "기수": "3기", "위도": 37.6262, "경도": 126.8669, "개발 규모": "8.1㎢", "주택 공급 호수": "38,000호", "교통망": "GTX-A, 대곡~고양선", "개발 연도": "2020년대"},
]

# 색상 설정 (기수별)
color_map = {
    "1기": "green",
    "2기": "blue",
    "3기": "red"
}

# DataFrame으로 변환
df = pd.DataFrame(new_towns)

# 지도 생성
st.subheader("🗺️ 수도권 신도시 지도 (folium)")
m = folium.Map(location=[37.45, 127.0], zoom_start=10)

# 마커 추가
for _, row in df.iterrows():
    popup_html = f"""
    <b>{row['신도시명']}</b><br>
    기수: {row['기수']}<br>
    규모: {row['개발 규모']}<br>
    공급: {row['주택 공급 호수']}<br>
    교통망: {row['교통망']}<br>
    개발 연도: {row['개발 연도']}
    """
    folium.Marker(
        location=[row["위도"], row["경도"]],
        popup=folium.Popup(popup_html, max_width=300),
        tooltip=f"{row['신도시명']} ({row['기수']})",
        icon=folium.Icon(color=color_map[row["기수"]], icon="home")
    ).add_to(m)

# folium 지도 Streamlit에 표시
st_data = st_folium(m, width=1000, height=600)

# 표로도 출력
st.subheader("📊 신도시 정보 요약 표")
st.dataframe(df[["신도시명", "기수", "개발 규모", "주택 공급 호수", "교통망", "개발 연도"]], use_container_width=True)
